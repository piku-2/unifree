# 仕様

## プロダクト概要
- 大学内の学生同士が手渡し前提で出品・購入・相談できるモバイル最適化フリマアプリ。
- 目的：商品一覧 → 詳細 → チャットで購入相談 → 取引完了までを軽量な UI/UX で提供。

## 技術スタック
- Vite + React + TypeScript、Tailwind CSS、shadcn/ui。
- 状態管理：React Hooks（必要に応じて Context / Zustand）。
- バックエンド：Supabase（Auth / Table / Storage / Realtime 任意）。

## 主要機能（MVP）
- 商品一覧：画像 1:1、タイトル、価格表示。検索バー、並び替え（新着/人気）。カテゴリフィルターは後追加可。
- 商品詳細：画像カルーセル、価格、説明、出品者情報、「メッセージして購入相談」CTA。
- 出品：画像複数、タイトル、説明、カテゴリ、価格。Draft → Confirm → Submit フロー。
- マイページ：自分の出品一覧、編集・削除。購入申請一覧は優先度中。
- チャット：1 対 1 取引メッセージ（テキスト必須、画像任意）。双方が取引完了を押せる。
- 認証：Supabase Auth（メール/Magic Link）。未ログイン時は出品・購入相談不可。

## 画面 / ルーティング想定
- `/` 商品一覧
- `/items/:id` 商品詳細
- `/sell` 出品フォーム（Draft/Confirm/Submit）
- `/mypage` マイページ（出品管理）
- `/chat/:roomId` 取引メッセージ
- （管理者向け）`/admin` / `/admin/items` / `/admin/orders` は後続検討

## UI / UX 原則
- モバイルファーストの 1 カラム。カード中心、画像比率 1:1。
- プライマリは青系、アクセントに紫系。角丸大きめ、影は控えめ。
- ローディング/エラー/空状態を明確に表示。skeleton + spinner を用意。

## データモデル（Supabase）
- `items`: `id (uuid PK)`, `user_id (uuid FK)`, `title (text)`, `description (text)`, `price (integer)`, `images (text[])`, `created_at (timestamp default now())`.
- `rooms`: `id (uuid PK)`, `item_id (uuid FK items)`, `buyer_id (uuid)`, `seller_id (uuid)`.
- `messages`: `id (uuid PK)`, `room_id (uuid FK rooms)`, `sender_id (uuid)`, `body (text optional)`, `image_url (text optional)`, `created_at (timestamp default now())`.
- RLS: `items` は全件参照可。`INSERT/UPDATE/DELETE` は `auth.uid() = user_id`。`rooms/messages` は当事者（buyer/seller または sender）が参照・書き込み可。

## API / アクション方針
- `getItems(filters)`: 並び替え・検索・カテゴリを考慮して一覧取得。
- `createItem(formData)`: Supabase Storage への画像アップロード + items への挿入。
- `startChat(itemId)`: item ごとに buyer/seller で room を生成または再利用。
- `sendMessage(roomId, { body?, image })`: テキスト/画像送信。エラーは feature 内で処理し、UI には toasts で通知。
- Realtime（任意）：`messages` を subscribe してチャットを自動更新。

## バリデーション / 状態管理
- すべてのフォームで Zod スキーマを使用。`schema.ts` を feature 配下に置く。
- `isLoading` / `isSubmitting` を統一管理し、ボタン無効化とローディング表示を行う。

## ディレクトリと責務
- ドメインごとに `src/features/<domain>/`（components/hooks/api/schema/types）。
- 共有基盤は `src/libs/`、設定は `src/config/`。
- 再利用 UI は `src/components/ui` / `src/components/common`。`src/components/figma` と `src/styles` は読み取り専用。
- 2 スペースインデント、シングルクォート、セミコロン。UI デザインを変更しない。

## 環境設定
- Node 18+ / npm 9+。セットアップ：`npm install`、開発：`npm run dev`、ビルド：`npm run build`。
- 必須環境変数（値は空のまま管理）:
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - `SUPABASE_SERVICE_ROLE_KEY`（サーバー処理専用。フロントでは使用しない）

## 非機能要件
- パフォーマンス：軽量レイアウトと画像最適化を前提。
- セキュリティ：Supabase Auth + RLS/Storage 権限制御。
- スケーラビリティ：シンプルな Supabase モデルを維持。出品者通報や通知は後続フェーズ。
